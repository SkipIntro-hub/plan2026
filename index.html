<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Acción 2026 | Analyzer Pro V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0f;display:flex;align-items:center;justify-content:center;z-index:99999}#login-screen.hidden{display:none}#main-content{display:none}#main-content.visible{display:block}.login-box{background:#12121a;border:1px solid #2a2a3a;border-radius:16px;padding:3rem;text-align:center;max-width:400px;width:90%}.login-box h2{font-family:'DM Sans',sans-serif;font-size:1.5rem;color:#f0f0f5;margin-bottom:.5rem}.login-box p{color:#8888a0;font-size:.9rem;margin-bottom:2rem}.login-box input{width:100%;padding:.85rem 1rem;background:#1a1a24;border:1px solid #2a2a3a;border-radius:8px;color:#f0f0f5;font-family:'DM Sans',sans-serif;font-size:1rem;margin-bottom:1rem;text-align:center}.login-box input:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15)}.login-box button{width:100%;padding:.85rem;background:#6366f1;border:none;border-radius:8px;color:#fff;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s}.login-box button:hover{background:#5558e3}.login-error{color:#ef4444;font-size:.85rem;margin-top:1rem;display:none}:root{--bg-deep:#0a0a0f;--bg-card:#12121a;--bg-elevated:#1a1a24;--border:#2a2a3a;--text-primary:#f0f0f5;--text-secondary:#8888a0;--text-muted:#55556a;--accent-fidelizacion:#00d4aa;--accent-relacionamiento:#6366f1;--accent-comunicacion:#f59e0b;--accent-branding:#ec4899;--accent-varios:#8b5cf6;--glow-fidelizacion:rgba(0,212,170,.15);--glow-relacionamiento:rgba(99,102,241,.15)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--bg-deep);color:var(--text-primary);min-height:100vh;overflow-x:hidden}.noise-overlay{position:fixed;top:0;left:0;width:100%;height:100%;opacity:.03;pointer-events:none;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");z-index:9999}header{padding:2.5rem 3rem;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(99,102,241,.08) 0%,transparent 100%)}.header-content{max-width:1600px;margin:0 auto;display:flex;justify-content:space-between;align-items:flex-end;gap:2rem;flex-wrap:wrap}.title-block h1{font-size:2.25rem;font-weight:600;letter-spacing:-.03em;margin-bottom:.5rem}.title-block h1 span{background:linear-gradient(135deg,var(--accent-relacionamiento),var(--accent-fidelizacion));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.title-block p{color:var(--text-secondary);font-size:.95rem}.kpi-strip{display:flex;gap:2.5rem}.kpi{text-align:right}.kpi-value{font-family:'Space Mono',monospace;font-size:1.75rem;font-weight:700;color:var(--text-primary)}.kpi-label{font-size:.75rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);margin-top:.25rem}.scenario-bar-wrapper{position:sticky;top:0;z-index:500;background:var(--bg-card);border-bottom:1px solid var(--border);box-shadow:0 4px 20px rgba(0,0,0,.5)}.scenario-bar{max-width:1600px;margin:0 auto;padding:1.5rem 3rem;display:flex;gap:2rem;align-items:center;flex-wrap:wrap}.scenario-selector{display:flex;align-items:center;gap:1rem;flex:1}.scenario-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted);white-space:nowrap}.scenario-dropdown{position:relative;flex:1;max-width:300px}.scenario-current{background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;padding:.75rem 1rem;display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:all .2s}.scenario-current:hover{border-color:var(--accent-relacionamiento)}.scenario-current input{background:transparent;border:none;color:var(--text-primary);font-family:'DM Sans',sans-serif;font-size:.95rem;font-weight:500;flex:1;outline:none}.scenario-current input:disabled{cursor:pointer}.scenario-arrow{color:var(--text-muted);font-size:.8rem;transition:transform .2s}.scenario-dropdown.open .scenario-arrow{transform:rotate(180deg)}.scenario-menu{position:absolute;top:calc(100% + .5rem);left:0;right:0;background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;overflow:hidden;z-index:1000;display:none}.scenario-dropdown.open .scenario-menu{display:block}.scenario-option{padding:.75rem 1rem;cursor:pointer;transition:background .2s;display:flex;align-items:center;gap:.5rem}.scenario-option:hover{background:var(--bg-card)}.scenario-option.active{background:var(--glow-relacionamiento);color:var(--accent-relacionamiento)}.scenario-option-dot{width:8px;height:8px;border-radius:50%;background:var(--accent-relacionamiento)}.scenario-info{display:flex;align-items:center;gap:1.5rem;padding:.5rem 1rem;background:var(--bg-elevated);border-radius:8px;border:1px solid var(--border)}.scenario-info-item{display:flex;flex-direction:column;gap:.25rem}.scenario-info-value{font-family:'Space Mono',monospace;font-size:1rem;font-weight:600;color:var(--text-primary)}.scenario-info-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted)}.mode-switch{display:flex;background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;padding:.25rem;gap:.25rem}.mode-option{padding:.5rem 1rem;font-size:.85rem;font-weight:500;color:var(--text-secondary);background:transparent;border:none;border-radius:6px;cursor:pointer;transition:all .2s;white-space:nowrap}.mode-option.active{background:var(--accent-relacionamiento);color:#fff}.scenario-actions{display:flex;gap:.75rem}.btn-scenario{padding:.65rem 1.25rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-family:'DM Sans',sans-serif;font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s;white-space:nowrap}.btn-scenario:hover{border-color:var(--accent-relacionamiento);background:var(--glow-relacionamiento)}.btn-scenario.primary{background:var(--accent-relacionamiento);border-color:var(--accent-relacionamiento);color:#fff}.btn-scenario.primary:hover{background:#5558e3}.btn-scenario.danger{background:transparent;border-color:#ef4444;color:#ef4444}.btn-scenario.danger:hover{background:rgba(239,68,68,.1)}.analytics-section{max-width:1600px;margin:0 auto;padding:2rem 3rem;border-bottom:1px solid var(--border);background:var(--bg-card)}.analytics-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.analytics-title{font-size:1.25rem;font-weight:600;color:var(--text-primary)}.analytics-toggle{display:flex;background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;padding:.25rem;gap:.25rem}.analytics-toggle-btn{padding:.5rem 1rem;font-size:.8rem;font-weight:500;color:var(--text-secondary);background:transparent;border:none;border-radius:6px;cursor:pointer;transition:all .2s}.analytics-toggle-btn.active{background:var(--accent-relacionamiento);color:#fff}.analytics-grid{display:grid;grid-template-columns:2fr 1fr;gap:2rem}.analytics-chart{background:var(--bg-elevated);border:1px solid var(--border);border-radius:12px;padding:1.5rem}.analytics-chart-title{font-size:.9rem;font-weight:600;color:var(--text-primary);margin-bottom:.5rem}.analytics-chart-subtitle{font-size:.75rem;color:var(--text-muted);margin-bottom:1.5rem}.chart-container{height:300px;position:relative}.leader-board{display:flex;flex-direction:column;gap:1rem}.leader-item{background:var(--bg-elevated);border:1px solid var(--border);border-radius:12px;padding:1.5rem}.leader-title{font-size:.75rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);margin-bottom:.75rem}.leader-value{font-family:'Space Mono',monospace;font-size:1.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.25rem}.leader-percent{font-size:.9rem;color:var(--text-secondary)}main{max-width:1600px;margin:0 auto;padding:2rem 3rem 4rem}.controls{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.filter-group{display:flex;flex-direction:column;gap:.5rem}.filter-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;color:var(--text-muted)}.filter-buttons{display:flex;gap:.5rem;flex-wrap:wrap}.filter-btn{padding:.5rem 1rem;background:var(--bg-card);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);font-family:'DM Sans',sans-serif;font-size:.85rem;cursor:pointer;transition:all .2s}.filter-btn:hover{border-color:var(--accent-relacionamiento)}.filter-btn.active{background:var(--glow-relacionamiento);border-color:var(--accent-relacionamiento);color:var(--accent-relacionamiento)}.month-filters{display:grid;grid-template-columns:repeat(13,1fr);gap:.35rem}.month-btn{padding:.5rem .25rem;background:var(--bg-card);border:1px solid var(--border);border-radius:6px;color:var(--text-secondary);font-family:'Space Mono',monospace;font-size:.7rem;cursor:pointer;transition:all .2s;text-align:center}.month-btn:hover{border-color:var(--accent-relacionamiento)}.month-btn.active{background:var(--glow-relacionamiento);border-color:var(--accent-relacionamiento);color:var(--accent-relacionamiento)}.month-btn.all-months{font-size:.65rem;padding:.5rem .5rem}.action-bar{display:flex;gap:1rem;margin-left:auto;align-items:flex-end}.btn-export{padding:.65rem 1.5rem;background:var(--accent-fidelizacion);border:none;border-radius:8px;color:var(--bg-deep);font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}.btn-export:hover{transform:translateY(-1px);box-shadow:0 4px 12px var(--glow-fidelizacion)}.btn-new-activity{padding:.65rem 1.5rem;background:var(--accent-relacionamiento);border:none;border-radius:8px;color:#fff;font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}.btn-new-activity:hover{transform:translateY(-1px);background:#5558e3}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.25rem}.card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--card-color),transparent);opacity:0;transition:opacity .25s}.card:hover::before{opacity:1}.card:hover{transform:translateY(-2px);border-color:var(--card-color);box-shadow:0 8px 24px rgba(0,0,0,.3)}.card.selected{border-color:var(--card-color);box-shadow:0 0 0 2px var(--card-color-glow)}.card.unselected{opacity:.4;filter:grayscale(.5)}.card.unselected:hover{opacity:.7}.card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;margin-bottom:1rem}.card-checkbox{width:20px;height:20px;border:2px solid var(--border);border-radius:4px;cursor:pointer;transition:all .2s;flex-shrink:0;position:relative;background:var(--bg-elevated)}.card-checkbox.checked{background:var(--card-color);border-color:var(--card-color)}.card-checkbox.checked::after{content:'✓';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;font-weight:700}.card-title-group{flex:1}.card-title{font-size:1.05rem;font-weight:600;color:var(--text-primary);margin-bottom:.35rem;line-height:1.3}.card-gestion{font-size:.75rem;color:var(--card-color);font-weight:500}.card-meta{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}.card-meta-item{display:flex;flex-direction:column;gap:.25rem}.card-meta-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted)}.card-meta-value{font-size:.85rem;color:var(--text-secondary)}.card-investment{margin-bottom:1rem}.card-investment-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);margin-bottom:.5rem}.card-investment-value{font-family:'Space Mono',monospace;font-size:1.5rem;font-weight:700;color:var(--text-primary)}.card-investment-value input{font-family:'Space Mono',monospace;font-size:1.5rem;font-weight:700;color:var(--text-primary);background:transparent;border:none;border-bottom:2px solid transparent;padding:0;width:100%;transition:border-color .2s}.card-investment-value input:focus{outline:none;border-bottom-color:var(--accent-relacionamiento)}.card-gantt{display:grid;grid-template-columns:repeat(12,1fr);gap:.25rem}.gantt-month{height:24px;background:var(--bg-elevated);border-radius:4px;transition:all .2s;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:600;color:transparent}.gantt-month.active{background:var(--card-color);box-shadow:0 0 8px var(--card-color-glow);color:#fff}.gantt-month.tentative{background:var(--card-color);opacity:.4;color:#fff}.gantt-month.ondemand{background:var(--card-color);opacity:.25;color:#fff}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);z-index:10000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;padding:2rem}.modal-overlay.open{opacity:1;pointer-events:all}.modal{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;max-width:700px;width:100%;max-height:90vh;overflow-y:auto;position:relative;transform:scale(.95);transition:transform .3s}.modal-overlay.open .modal{transform:scale(1)}.modal-header{padding:2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:flex-start;gap:1.5rem}.modal-title-group{flex:1}.modal-checkbox-large{width:32px;height:32px;border:3px solid var(--border);border-radius:6px;cursor:pointer;transition:all .2s;flex-shrink:0;position:relative;background:var(--bg-elevated)}.modal-checkbox-large.checked{background:var(--modal-color);border-color:var(--modal-color)}.modal-checkbox-large.checked::after{content:'✓';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:20px;font-weight:700}.modal-title{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:.75rem}.modal-gestion-badge{display:inline-block;padding:.35rem .85rem;border-radius:6px;font-size:.8rem;font-weight:500}.modal-close{background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);font-size:1.25rem;transition:all .2s;flex-shrink:0}.modal-close:hover{border-color:var(--accent-relacionamiento);color:var(--text-primary)}.modal-body{padding:2rem}.modal-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin-bottom:2rem}.modal-field{display:flex;flex-direction:column;gap:.5rem}.modal-field-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted)}.modal-field-value{font-size:1rem;color:var(--text-primary)}.modal-field input[type=number],.modal-field input[type=text],.modal-field select{background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;padding:.75rem;color:var(--text-primary);font-family:'DM Sans',sans-serif;font-size:1rem}.modal-field input[type=number]:focus,.modal-field input[type=text]:focus,.modal-field select:focus{outline:none;border-color:var(--accent-relacionamiento)}.modal-gantt-container{margin-top:2rem}.modal-gantt-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);margin-bottom:1rem}.modal-gantt{display:grid;grid-template-columns:repeat(12,1fr);gap:.5rem}.modal-gantt-month{padding:.75rem .5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:6px;text-align:center;font-size:.75rem;font-weight:500;color:var(--text-muted);transition:all .2s;cursor:pointer}.modal-gantt-month:hover{border-color:var(--accent-relacionamiento)}.modal-gantt-month.active{background:var(--modal-color);border-color:var(--modal-color);color:#fff;box-shadow:0 4px 12px var(--modal-color-glow)}.modal-gantt-month.tentative{background:var(--modal-color);border-color:var(--modal-color);color:#fff;opacity:.5}.modal-gantt-month.ondemand{background:var(--modal-color);border-color:var(--modal-color);color:#fff;opacity:.3}.month-detail-modal{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;max-width:900px;width:100%;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}.month-modal-header{padding:2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.month-modal-title{font-size:1.5rem;font-weight:600;color:var(--text-primary)}.month-modal-stats{display:flex;gap:2rem}.month-modal-stat{text-align:right}.month-modal-stat-value{font-family:'Space Mono',monospace;font-size:1.25rem;font-weight:700;color:var(--text-primary)}.month-modal-stat-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--text-muted);margin-top:.25rem}.month-modal-body{padding:2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem;overflow-y:auto}.month-modal-chart{height:300px;position:relative}.month-modal-list{display:flex;flex-direction:column;gap:.75rem}.month-modal-item{padding:1rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:8px;display:grid;grid-template-columns:1fr auto auto;gap:1rem;align-items:center;cursor:pointer;transition:all .2s}.month-modal-item:hover{border-color:var(--accent-relacionamiento);transform:translateX(4px)}.month-modal-item-info{display:flex;align-items:center;gap:.75rem}.month-modal-item-color{width:12px;height:12px;border-radius:50%}.month-modal-item-name{font-size:.9rem;font-weight:500;color:var(--text-primary)}.month-modal-item-gestion{font-size:.75rem;color:var(--text-muted);margin-left:.5rem}.month-modal-item-value{font-family:'Space Mono',monospace;font-size:.95rem;font-weight:600;color:var(--text-primary)}.month-modal-item-percent{font-size:.85rem;color:var(--text-muted);min-width:50px;text-align:right}@media (max-width:1024px){.grid{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}.month-modal-body,.analytics-grid{grid-template-columns:1fr}}@media (max-width:768px){header{padding:1.5rem 1.5rem}.scenario-bar,.analytics-section{padding:1rem 1.5rem}main{padding:1.5rem 1.5rem 3rem}.header-content{flex-direction:column;align-items:flex-start}.kpi-strip{width:100%;justify-content:space-between}.grid{grid-template-columns:1fr}.controls{flex-direction:column}.month-filters{grid-template-columns:repeat(7,1fr)}.modal-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    
    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <h2>Plan de Acción 2026</h2>
            <p>Ingresá la clave para continuar</p>
            <input type="password" id="password-input" placeholder="Clave" onkeypress="if(event.key === 'Enter') checkPassword()">
            <button onclick="checkPassword()">Acceder</button>
            <div class="login-error" id="login-error">Clave incorrecta</div>
        </div>
    </div>
    <!-- MAIN CONTENT -->
    <div id="main-content">
        <header>
            <div class="header-content">
                <div class="title-block">
                    <h1>Plan de Acción <span>2026</span></h1>
                    <p>Gestión estratégica de actividades y presupuesto</p>
                </div>
                <div class="kpi-strip">
                    <div class="kpi">
                        <div class="kpi-value" id="kpi-actividades">45</div>
                        <div class="kpi-label">Actividades</div>
                    </div>
                    <div class="kpi">
                        <div class="kpi-value" id="kpi-inversion">$0</div>
                        <div class="kpi-label">Inversión Total</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- SCENARIO BAR -->
        <div class="scenario-bar-wrapper">
        <div class="scenario-bar">
            <div class="scenario-selector">
                <div class="scenario-label">Escenario</div>
                <div class="scenario-dropdown" id="scenario-dropdown">
                    <div class="scenario-current" onclick="toggleScenarioDropdown()">
                        <input type="text" id="scenario-name-input" value="Todas las actividades" disabled onblur="saveScenarioName()" onkeypress="if(event.key === 'Enter') this.blur()">
                        <span class="scenario-arrow">▼</span>
                    </div>
                    <div class="scenario-menu" id="scenario-menu"></div>
                </div>
            </div>
            <div class="scenario-info">
                <div class="scenario-info-item">
                    <div class="scenario-info-value" id="scenario-activities-count">45/45</div>
                    <div class="scenario-info-label">Actividades</div>
                </div>
                <div class="scenario-info-item">
                    <div class="scenario-info-value" id="scenario-budget">$0</div>
                    <div class="scenario-info-label">Presupuesto</div>
                </div>
            </div>
            <div class="mode-switch">
                <button class="mode-option active" onclick="setMode('add')">Agregar</button>
                <button class="mode-option" onclick="setMode('remove')">Quitar</button>
            </div>
            <div class="scenario-actions">
                <button class="btn-scenario danger" onclick="resetToZero()">Reset a Cero</button>
                <button class="btn-scenario" onclick="resetScenario()">Reset a Todas</button>
                <button class="btn-scenario primary" onclick="saveScenario()">Guardar Escenario</button>
            </div>
        </div>
        </div><!-- /scenario-bar-wrapper -->

        <!-- ANALYTICS SECTION -->
        <div class="analytics-section">
            <div class="analytics-header">
                <div class="analytics-title">Análisis Visual del Presupuesto</div>
                <div class="analytics-toggle">
                    <button class="analytics-toggle-btn active" onclick="setAnalyticsView('mensual')">Mensual</button>
                    <button class="analytics-toggle-btn" onclick="setAnalyticsView('acumulado')">Acumulado</button>
                </div>
            </div>
            <div class="analytics-grid">
                <div class="analytics-chart">
                    <div class="analytics-chart-title">Inversión Mensual por Gestión</div>
                    <div class="analytics-chart-subtitle">Distribución del presupuesto a lo largo del año</div>
                    <div class="chart-container"><canvas id="monthlyChart"></canvas></div>
                </div>
                <div class="leader-board">
                    <div class="analytics-chart">
                        <div class="analytics-chart-title">Composición Total</div>
                        <div class="analytics-chart-subtitle">Peso relativo por gestión</div>
                        <div class="chart-container" style="height:200px"><canvas id="compositionChart"></canvas></div>
                    </div>
                    <div class="leader-item">
                        <div class="leader-title">Gestión Líder</div>
                        <div class="leader-value" id="leader-name">-</div>
                        <div class="leader-percent" id="leader-amount">$0 (0%)</div>
                    </div>
                </div>
            </div>
        </div>

        <main>
            <div class="controls">
                <div class="filter-group">
                    <div class="filter-label">Gestión</div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="gestion" data-value="all">Todas</button>
                        <button class="filter-btn" data-filter="gestion" data-value="FIDELIZACION">Fidelización</button>
                        <button class="filter-btn" data-filter="gestion" data-value="RELACIONAMIENTO">Relacionamiento</button>
                        <button class="filter-btn" data-filter="gestion" data-value="COMUNICACIÓN">Comunicación</button>
                        <button class="filter-btn" data-filter="gestion" data-value="BRANDING">Branding</button>
                        <button class="filter-btn" data-filter="gestion" data-value="VARIOS">Varios</button>
                    </div>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Tipo</div>
                    <div class="filter-buttons" id="tipo-filters">
                        <button class="filter-btn active" data-filter="tipo" data-value="all">Todos</button>
                    </div>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Frecuencia</div>
                    <div class="filter-buttons" id="frecuencia-filters">
                        <button class="filter-btn active" data-filter="frecuencia" data-value="all">Todas</button>
                    </div>
                </div>
                <div class="filter-group" style="flex:1">
                    <div class="filter-label">Meses</div>
                    <div class="month-filters">
                        <button class="month-btn all-months" onclick="toggleAllMonths()">TODO</button>
                        <button class="month-btn" data-filter="month" data-value="0">E</button>
                        <button class="month-btn" data-filter="month" data-value="1">F</button>
                        <button class="month-btn" data-filter="month" data-value="2">M</button>
                        <button class="month-btn" data-filter="month" data-value="3">A</button>
                        <button class="month-btn" data-filter="month" data-value="4">M</button>
                        <button class="month-btn" data-filter="month" data-value="5">J</button>
                        <button class="month-btn" data-filter="month" data-value="6">J</button>
                        <button class="month-btn" data-filter="month" data-value="7">A</button>
                        <button class="month-btn" data-filter="month" data-value="8">S</button>
                        <button class="month-btn" data-filter="month" data-value="9">O</button>
                        <button class="month-btn" data-filter="month" data-value="10">N</button>
                        <button class="month-btn" data-filter="month" data-value="11">D</button>
                    </div>
                </div>
                <div class="action-bar">
                    <button class="btn-new-activity" onclick="openNewActivityModal()">+ Nueva Actividad</button>
                    <button class="btn-export" id="btn-export">Exportar Excel</button>
                </div>
            </div>
            <div class="grid" id="activities-grid"></div>
        </main>

        <!-- MODAL DETALLE -->
        <div class="modal-overlay" id="detail-modal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-checkbox-large" id="modal-checkbox" onclick="toggleActivityFromModal()"></div>
                    <div class="modal-title-group">
                        <h2 class="modal-title" id="modal-title">Actividad</h2>
                        <span class="modal-gestion-badge" id="modal-gestion-badge">Gestión</span>
                    </div>
                    <button class="modal-close" onclick="closeModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="modal-grid">
                        <div class="modal-field"><div class="modal-field-label">Tipo</div><div class="modal-field-value" id="modal-tipo">-</div></div>
                        <div class="modal-field"><div class="modal-field-label">Frecuencia</div><div class="modal-field-value" id="modal-frecuencia">-</div></div>
                        <div class="modal-field"><div class="modal-field-label">Unidad</div><div class="modal-field-value" id="modal-unidad">-</div></div>
                        <div class="modal-field"><div class="modal-field-label">Cantidad</div><div class="modal-field-value" id="modal-cantidad">-</div></div>
                        <div class="modal-field"><div class="modal-field-label">Repetición</div><div class="modal-field-value" id="modal-repeticion">-</div></div>
                        <div class="modal-field"><div class="modal-field-label">% del Total</div><div class="modal-field-value" id="modal-porcentaje">-</div></div>
                        <div class="modal-field" style="grid-column:1/-1"><div class="modal-field-label">Inversión Anual</div><input type="number" id="modal-inversion" value="0"></div>
                    </div>
                    <div class="modal-gantt-container">
                        <div class="modal-gantt-label">Timeline 2026</div>
                        <div class="modal-gantt" id="modal-gantt"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL MES -->
        <div class="modal-overlay" id="month-detail-modal">
            <div class="month-detail-modal">
                <div class="month-modal-header">
                    <h2 class="month-modal-title" id="month-modal-title">Mes 2026</h2>
                    <div class="month-modal-stats">
                        <div class="month-modal-stat"><div class="month-modal-stat-value" id="month-modal-activities">0</div><div class="month-modal-stat-label">Actividades</div></div>
                        <div class="month-modal-stat"><div class="month-modal-stat-value" id="month-modal-total">$0</div><div class="month-modal-stat-label">Inversión</div></div>
                    </div>
                    <button class="modal-close" onclick="closeMonthModal()">×</button>
                </div>
                <div class="month-modal-body">
                    <div class="month-modal-chart"><canvas id="monthDetailChart"></canvas></div>
                    <div class="month-modal-list" id="month-modal-list"></div>
                </div>
            </div>
        </div>

        <!-- MODAL NUEVA ACTIVIDAD -->
        <div class="modal-overlay" id="new-activity-modal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title-group"><h2 class="modal-title">Nueva Actividad</h2></div>
                    <button class="modal-close" onclick="closeNewActivityModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="modal-grid">
                        <div class="modal-field" style="grid-column:1/-1"><div class="modal-field-label">Nombre</div><input type="text" id="new-actividad" placeholder="Ej: Workshop de inversión"></div>
                        <div class="modal-field"><div class="modal-field-label">Gestión</div><select id="new-gestion"><option value="FIDELIZACION">Fidelización</option><option value="RELACIONAMIENTO">Relacionamiento</option><option value="COMUNICACIÓN">Comunicación</option><option value="BRANDING">Branding</option><option value="VARIOS">Varios</option></select></div>
                        <div class="modal-field"><div class="modal-field-label">Tipo</div><select id="new-tipo"></select></div>
                        <div class="modal-field"><div class="modal-field-label">Frecuencia</div><select id="new-frecuencia"></select></div>
                        <div class="modal-field"><div class="modal-field-label">Unidad ($)</div><input type="number" id="new-unidad" value="0"></div>
                        <div class="modal-field"><div class="modal-field-label">Cantidad</div><input type="number" id="new-cantidad" value="1"></div>
                        <div class="modal-field"><div class="modal-field-label">Repetición</div><input type="number" id="new-repeticion" value="1"></div>
                    </div>
                    <div class="modal-gantt-container">
                        <div class="modal-gantt-label">Meses Activos (click para seleccionar)</div>
                        <div class="modal-gantt" id="new-activity-gantt"></div>
                    </div>
                    <div style="margin-top:2rem;display:flex;gap:1rem">
                        <button class="btn-scenario" onclick="closeNewActivityModal()" style="flex:1">Cancelar</button>
                        <button class="btn-scenario primary" onclick="saveNewActivity()" style="flex:1">Crear Actividad</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
// DATOS REALES PLAN 2026
let activities=[{id:1,gestion:'FIDELIZACION',tipo:'EVENTO MAYOR',actividad:'ATP',frecuencia:'1- ANUAL',unidad:25000,cantidad:1,repeticion:1,inversion:25000,meses:[0,1,0,0,0,0,0,0,0,0,0,0]},{id:2,gestion:'FIDELIZACION',tipo:'EVENTO MAYOR',actividad:'MOVISTAR ARENA (SHOWS)',frecuencia:'7- CONTINUO/SEMANAL',unidad:140000,cantidad:1,repeticion:1,inversion:140000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:3,gestion:'RELACIONAMIENTO',tipo:'EVENTO MAYOR',actividad:'EVENTO SUMMIT',frecuencia:'1- ANUAL',unidad:200000,cantidad:1,repeticion:1,inversion:200000,meses:[0,0,0,0,1,0,0,0,0,0,0,0]},{id:4,gestion:'RELACIONAMIENTO',tipo:'EVENTO MAYOR',actividad:'SKI BARILOCHE',frecuencia:'1- ANUAL',unidad:25000,cantidad:1,repeticion:1,inversion:25000,meses:[0,0,0,0,0,0,0,1,0,0,0,0]},{id:5,gestion:'RELACIONAMIENTO',tipo:'EVENTO MAYOR',actividad:'EVENTO SEGUROS (+ ESTADÍA + ALMUERZO VIP)',frecuencia:'1- ANUAL',unidad:100000,cantidad:1,repeticion:1,inversion:100000,meses:[0,0,0,0,0,0,0,0,1,0,0,0]},{id:6,gestion:'FIDELIZACION',tipo:'EVENTO MAYOR',actividad:'EVENTO DE FIN DE AÑO CLIENTES',frecuencia:'1- ANUAL',unidad:200000,cantidad:1,repeticion:1,inversion:200000,meses:[0,0,0,0,0,0,0,0,0,0,0,1]},{id:7,gestion:'FIDELIZACION',tipo:'EVENTO MENOR',actividad:'EVENTO FIN DE AÑO FAMILY & FRIENDS',frecuencia:'1- ANUAL',unidad:30000,cantidad:1,repeticion:1,inversion:30000,meses:[0,0,0,0,0,0,0,0,0,0,0,1]},{id:8,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'AFTER OFFICE (EXTERNO)',frecuencia:'4- BIMESTRAL',unidad:5000,cantidad:5,repeticion:1,inversion:25000,meses:[0,1,0,1,0,1,0,1,0,1,0,0]},{id:9,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'AFTER OFFICE (OFICINA)(CATAS)',frecuencia:'4- BIMESTRAL',unidad:7000,cantidad:5,repeticion:1,inversion:35000,meses:[0,0,1,0,1,0,1,0,1,0,1,0]},{id:10,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'ALMUERZOS OFICINA (SPEAKER)',frecuencia:'5- MENSUAL',unidad:5000,cantidad:9,repeticion:1,inversion:45000,meses:[0,0,1,1,1,1,1,1,1,1,1,0]},{id:11,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'EVENTOS PROPIOS INTERIOR (DESAYUNOS, CENAS)',frecuencia:'5- MENSUAL',unidad:4000,cantidad:10,repeticion:1,inversion:40000,meses:[0,0,1,1,1,1,1,1,1,1,1,1]},{id:12,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'ALMUERZOS OFICINA (COMERCIAL)',frecuencia:'7- CONTINUO/SEMANAL',unidad:500,cantidad:8,repeticion:9,inversion:36000,meses:[0,0,1,1,1,1,1,1,1,1,1,0]},{id:13,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'CENAS EXCLUSIVAS (CASA VG + CENAS PREVIAS SUMMIT Y SEGUROS)',frecuencia:'3- TRIMESTRAL',unidad:10000,cantidad:3,repeticion:1,inversion:30000,meses:[0,0,1,0,0,1,0,0,1,0,0,0]},{id:14,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'WEEKENDS EXCLUSIVOS (VINOS MZA)',frecuencia:'8- EVENTUAL',unidad:10000,cantidad:2,repeticion:1,inversion:20000,meses:[0,0,0,2,0,0,0,0,2,0,0,0]},{id:15,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'EVENTO MUJERES',frecuencia:'2- SEMESTRAL',unidad:10000,cantidad:2,repeticion:1,inversion:20000,meses:[0,0,0,1,0,0,0,0,0,1,0,0]},{id:16,gestion:'FIDELIZACION',tipo:'EVENTO MENOR',actividad:'CLÍNICA DE TENIS/ PADEL',frecuencia:'2- SEMESTRAL',unidad:10000,cantidad:2,repeticion:1,inversion:20000,meses:[0,0,1,0,0,0,0,0,0,1,0,0]},{id:17,gestion:'RELACIONAMIENTO',tipo:'EVENTO MENOR',actividad:'ALMUERZOS ESPECIALES (EXTERNOS)(SPEAKER) (MECON)',frecuencia:'2- SEMESTRAL',unidad:10000,cantidad:2,repeticion:1,inversion:20000,meses:[0,0,0,0,0,1,0,0,0,0,0,1]},{id:18,gestion:'FIDELIZACION',tipo:'EVENTO MENOR',actividad:'WAKE BOARD',frecuencia:'8- EVENTUAL',unidad:3000,cantidad:2,repeticion:1,inversion:6000,meses:[0,0,0,0,0,0,0,0,0,0,2,2]},{id:19,gestion:'RELACIONAMIENTO',tipo:'SPONSOREO MAYOR',actividad:'IAEF - CONGRESO ANUAL (CEC)',frecuencia:'1- ANUAL',unidad:15000,cantidad:1,repeticion:1,inversion:15000,meses:[0,0,0,0,0,1,0,0,0,0,0,0]},{id:20,gestion:'RELACIONAMIENTO',tipo:'SPONSOREO MAYOR',actividad:'IAEF - CENA PROPIA (EN CONVENCIÓN)',frecuencia:'1- ANUAL',unidad:25000,cantidad:1,repeticion:1,inversion:25000,meses:[0,0,0,0,0,0,0,0,1,0,0,0]},{id:21,gestion:'RELACIONAMIENTO',tipo:'SPONSOREO MAYOR',actividad:'IAEF - CONVENCIÓN ANUAL (INTERIOR)',frecuencia:'1- ANUAL',unidad:50000,cantidad:1,repeticion:1,inversion:50000,meses:[0,0,0,0,0,0,0,0,1,0,0,0]},{id:22,gestion:'RELACIONAMIENTO',tipo:'SPONSOREO MENOR',actividad:'EXPOS (SECTORES PRODUCTIVOS)',frecuencia:'8- EVENTUAL',unidad:20000,cantidad:1,repeticion:1,inversion:20000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:23,gestion:'RELACIONAMIENTO',tipo:'SPONSOREO MENOR',actividad:'SPONSOREOS VARIOS (WEF, AGEI, CAJAS, MINERÍA)',frecuencia:'8- EVENTUAL',unidad:20000,cantidad:1,repeticion:1,inversion:20000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:24,gestion:'FIDELIZACION',tipo:'ACCIONES NETWORKING',actividad:'FUTBOL',frecuencia:'7- CONTINUO/SEMANAL',unidad:500,cantidad:4,repeticion:12,inversion:24000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:25,gestion:'FIDELIZACION',tipo:'ACCIONES NETWORKING',actividad:'PADDLE',frecuencia:'7- CONTINUO/SEMANAL',unidad:250,cantidad:4,repeticion:12,inversion:12000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:26,gestion:'FIDELIZACION',tipo:'ACCIONES NETWORKING',actividad:'TENIS',frecuencia:'7- CONTINUO/SEMANAL',unidad:250,cantidad:4,repeticion:12,inversion:12000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:27,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'AMCHAM',frecuencia:'8- EVENTUAL',unidad:5000,cantidad:1,repeticion:1,inversion:5000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:28,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'CÁMARA FINTECH',frecuencia:'8- EVENTUAL',unidad:5000,cantidad:1,repeticion:1,inversion:5000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:29,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'CÁMARA MINERÍA',frecuencia:'8- EVENTUAL',unidad:5000,cantidad:1,repeticion:1,inversion:5000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:30,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'CÁMARA OIL & GAS',frecuencia:'8- EVENTUAL',unidad:5000,cantidad:1,repeticion:1,inversion:5000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:31,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'IDEA',frecuencia:'8- EVENTUAL',unidad:10000,cantidad:1,repeticion:1,inversion:10000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:32,gestion:'RELACIONAMIENTO',tipo:'ACCIONES NETWORKING',actividad:'SOMOS PYMES',frecuencia:'8- EVENTUAL',unidad:5000,cantidad:1,repeticion:1,inversion:5000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:33,gestion:'RELACIONAMIENTO',tipo:'ACCIONES SALES',actividad:'DESAYUNOS OFICINA (COMERCIAL)',frecuencia:'6- QUINCENAL',unidad:300,cantidad:8,repeticion:9,inversion:21600,meses:[0,0,1,1,1,1,1,1,1,1,0,0]},{id:34,gestion:'RELACIONAMIENTO',tipo:'ACCIONES SALES',actividad:'DESAYUNOS OFICINA (TÉCNICO)',frecuencia:'6- QUINCENAL',unidad:500,cantidad:4,repeticion:9,inversion:18000,meses:[0,0,1,1,1,1,1,1,1,1,0,0]},{id:35,gestion:'FIDELIZACION',tipo:'ACCIONES RESEARCH',actividad:'WEBINAR MENSUAL',frecuencia:'5- MENSUAL',unidad:0,cantidad:1,repeticion:1,inversion:0,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:36,gestion:'FIDELIZACION',tipo:'ACCIONES RESEARCH',actividad:'WEBINARS ESPECIALES',frecuencia:'8- EVENTUAL',unidad:0,cantidad:1,repeticion:1,inversion:0,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:37,gestion:'FIDELIZACION',tipo:'ACCIONES PR',actividad:'COLÓN/RIVER/BOCA',frecuencia:'8- EVENTUAL',unidad:1000,cantidad:12,repeticion:1,inversion:12000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:38,gestion:'FIDELIZACION',tipo:'ACCIONES PR',actividad:'INVITACIONES ESPECIALES (RECITALES, PALCOS)',frecuencia:'8- EVENTUAL',unidad:1000,cantidad:12,repeticion:1,inversion:12000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:39,gestion:'FIDELIZACION',tipo:'ACCIONES PR',actividad:'DÍA DEL/LA...',frecuencia:'8- EVENTUAL',unidad:10000,cantidad:1,repeticion:1,inversion:10000,meses:[2,2,2,2,2,2,2,2,2,2,2,2]},{id:40,gestion:'FIDELIZACION',tipo:'ACCIONES PR',actividad:'REGALOS ONGOING (PICADAS, DESAYUNOS, OTROS)',frecuencia:'9- ONDEMAND',unidad:10000,cantidad:1,repeticion:1,inversion:10000,meses:[3,3,3,3,3,3,3,3,3,3,3,3]},{id:41,gestion:'COMUNICACIÓN',tipo:'CONTENT',actividad:'POSTEOS',frecuencia:'7- CONTINUO/SEMANAL',unidad:1000,cantidad:12,repeticion:1,inversion:12000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:42,gestion:'COMUNICACIÓN',tipo:'PAUTA',actividad:'GOOGLE ADS/ LINKEDIN/ OTROS',frecuencia:'7- CONTINUO/SEMANAL',unidad:3000,cantidad:12,repeticion:1,inversion:36000,meses:[1,1,1,1,1,1,1,1,1,1,1,1]},{id:43,gestion:'BRANDING',tipo:'PRODUCCION',actividad:'MATERIALES VARIOS',frecuencia:'9- ONDEMAND',unidad:35000,cantidad:1,repeticion:1,inversion:35000,meses:[3,3,3,3,3,3,3,3,3,3,3,3]},{id:44,gestion:'FIDELIZACION',tipo:'PRODUCCION',actividad:'REGALOS DE FIN DE AÑO',frecuencia:'1- ANUAL',unidad:50000,cantidad:1,repeticion:1,inversion:50000,meses:[0,0,0,0,0,0,0,0,0,0,1,0]},{id:45,gestion:'VARIOS',tipo:'TBD',actividad:'TBD',frecuencia:'9- ONDEMAND',unidad:3400,cantidad:1,repeticion:1,inversion:3400,meses:[3,3,3,3,3,3,3,3,3,3,3,3]}];
let nextActivityId=46;let newActivityMonths=[0,0,0,0,0,0,0,0,0,0,0,0];
const months=['E','F','M','A','M','J','J','A','S','O','N','D'];
const monthsFull=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
let scenarios={all:{name:'Todas las actividades',activities:activities.map(a=>a.id),locked:true},esc1:{name:'Escenario 1',activities:activities.map(a=>a.id),locked:false},esc2:{name:'Escenario 2',activities:activities.map(a=>a.id),locked:false}};
let currentScenario='all',currentMode='add',analyticsView='mensual';
let filters={gestion:'all',tipo:'all',frecuencia:'all',months:[]};
let totalInversion=0,monthDetailChart=null,monthlyChartInstance=null,compositionChartInstance=null,currentModalId=null;
function formatCurrency(v){return new Intl.NumberFormat('es-AR',{style:'currency',currency:'ARS',minimumFractionDigits:0,maximumFractionDigits:0}).format(v)}
function getGestionClass(g){const m={'FIDELIZACION':'fidelizacion','RELACIONAMIENTO':'relacionamiento','COMUNICACIÓN':'comunicacion','BRANDING':'branding','VARIOS':'varios'};return m[g]||'varios'}
function getGestionColor(g){const c={'FIDELIZACION':'#00d4aa','RELACIONAMIENTO':'#6366f1','COMUNICACIÓN':'#f59e0b','BRANDING':'#ec4899','VARIOS':'#8b5cf6'};return c[g]||'#8b5cf6'}
function getGestionGlow(g){const gl={'FIDELIZACION':'rgba(0,212,170,0.15)','RELACIONAMIENTO':'rgba(99,102,241,0.15)','COMUNICACIÓN':'rgba(245,158,11,0.15)','BRANDING':'rgba(236,72,153,0.15)','VARIOS':'rgba(139,92,246,0.15)'};return gl[g]||'rgba(139,92,246,0.15)'}
function loadScenarios(){const s=localStorage.getItem('plan2026_scenarios_v2');if(s){const l=JSON.parse(s);scenarios={all:{...scenarios.all},esc1:l.esc1||scenarios.esc1,esc2:l.esc2||scenarios.esc2}}}
function saveScenarios(){const t={esc1:scenarios.esc1,esc2:scenarios.esc2};localStorage.setItem('plan2026_scenarios_v2',JSON.stringify(t))}
function initScenarios(){loadScenarios();renderScenarioDropdown();updateScenarioUI()}
function renderScenarioDropdown(){const m=document.getElementById('scenario-menu');m.innerHTML=Object.keys(scenarios).map(k=>{const sc=scenarios[k],isA=k===currentScenario;return`<div class="scenario-option ${isA?'active':''}" onclick="selectScenario('${k}')">${isA?'<span class="scenario-option-dot"></span>':''}<span>${sc.name}</span></div>`}).join('')}
function toggleScenarioDropdown(){const d=document.getElementById('scenario-dropdown');d.classList.toggle('open');const inp=document.getElementById('scenario-name-input'),isL=scenarios[currentScenario].locked;inp.disabled=isL||d.classList.contains('open')}
document.addEventListener('click',function(e){const d=document.getElementById('scenario-dropdown');if(!d.contains(e.target))d.classList.remove('open')});
function selectScenario(k){currentScenario=k;updateScenarioUI();render();renderAnalytics();toggleScenarioDropdown()}
function updateScenarioUI(){const sc=scenarios[currentScenario],inp=document.getElementById('scenario-name-input');inp.value=sc.name;inp.disabled=sc.locked;const tA=activities.length,sA=sc.activities.length,sB=activities.filter(a=>sc.activities.includes(a.id)).reduce((s,a)=>s+a.inversion,0);document.getElementById('scenario-activities-count').textContent=`${sA}/${tA}`;document.getElementById('scenario-budget').textContent=formatCurrency(sB);renderScenarioDropdown()}
function saveScenarioName(){if(!scenarios[currentScenario].locked){const inp=document.getElementById('scenario-name-input');scenarios[currentScenario].name=inp.value;saveScenarios();renderScenarioDropdown()}}
function setMode(m){currentMode=m;const btns=document.querySelectorAll('.mode-option');btns.forEach(b=>{if(b.textContent.toLowerCase()===(m==='add'?'agregar':'quitar'))b.classList.add('active');else b.classList.remove('active')})}
function toggleActivity(id){const sc=scenarios[currentScenario];if(sc.locked)return;const idx=sc.activities.indexOf(id);if(currentMode==='add'){if(idx===-1)sc.activities.push(id)}else{if(idx!==-1)sc.activities.splice(idx,1)}updateScenarioUI();render();renderAnalytics()}
function toggleActivityFromModal(){if(currentModalId!==null){toggleActivity(currentModalId);updateModalCheckbox()}}
function updateModalCheckbox(){const cb=document.getElementById('modal-checkbox'),isS=scenarios[currentScenario].activities.includes(currentModalId);if(isS)cb.classList.add('checked');else cb.classList.remove('checked')}
function resetToZero(){if(scenarios[currentScenario].locked)return;if(confirm('¿Vaciar este escenario (remover todas las actividades)?')){scenarios[currentScenario].activities=[];updateScenarioUI();render();renderAnalytics()}}
function resetScenario(){if(scenarios[currentScenario].locked)return;if(confirm('¿Resetear este escenario a todas las actividades seleccionadas?')){scenarios[currentScenario].activities=activities.map(a=>a.id);updateScenarioUI();render();renderAnalytics()}}
function saveScenario(){saveScenarios();localStorage.setItem('plan2026_activities',JSON.stringify(activities));alert('Escenario guardado correctamente')}
function filterActivities(){return activities.filter(a=>{if(filters.gestion!=='all'&&a.gestion!==filters.gestion)return false;if(filters.tipo!=='all'&&a.tipo!==filters.tipo)return false;if(filters.frecuencia!=='all'&&a.frecuencia!==filters.frecuencia)return false;if(filters.months.length>0){const hM=filters.months.some(m=>a.meses[m]>0);if(!hM)return false}return true})}
function render(){const flt=filterActivities(),grd=document.getElementById('activities-grid'),sc=scenarios[currentScenario],scA=activities.filter(a=>sc.activities.includes(a.id)),scC=scA.length;totalInversion=scA.reduce((s,a)=>s+a.inversion,0);document.getElementById('kpi-actividades').textContent=scC;document.getElementById('kpi-inversion').textContent=formatCurrency(totalInversion);grd.innerHTML=flt.map(a=>{const gC=getGestionClass(a.gestion),col=getGestionColor(a.gestion),glw=getGestionGlow(a.gestion),isS=sc.activities.includes(a.id);return`<div class="card ${isS?'selected':'unselected'}" style="--card-color:${col};--card-color-glow:${glw}" onclick="openModal(${a.id})"><div class="card-header"><div class="card-checkbox ${isS?'checked':''}" onclick="event.stopPropagation();toggleActivity(${a.id})"></div><div class="card-title-group"><div class="card-title">${a.actividad}</div><div class="card-gestion">${a.gestion}</div></div></div><div class="card-meta"><div class="card-meta-item"><div class="card-meta-label">Tipo</div><div class="card-meta-value">${a.tipo}</div></div><div class="card-meta-item"><div class="card-meta-label">Frecuencia</div><div class="card-meta-value">${a.frecuencia.replace(/^\d+- /,'')}</div></div></div><div class="card-investment"><div class="card-investment-label">Inversión Anual</div><div class="card-investment-value"><input type="number" value="${a.inversion}" onclick="event.stopPropagation();" onchange="updateInversionInline(${a.id},this.value)" style="width:100%"></div></div><div class="card-gantt">${a.meses.map((m,i)=>{let cls='gantt-month',lbl='';if(m===1){cls+=' active';lbl=months[i]}else if(m===2){cls+=' tentative';lbl=months[i]}else if(m===3){cls+=' ondemand';lbl=months[i]}return`<div class="${cls}">${lbl}</div>`}).join('')}</div></div>`}).join('')}
function updateInversionInline(id,nv){const idx=activities.findIndex(a=>a.id===id);if(idx!==-1){activities[idx].inversion=parseInt(nv)||0;updateScenarioUI();renderAnalytics()}}
function toggleAllMonths(){const mBtns=document.querySelectorAll('[data-filter="month"]'),allA=filters.months.length===12;if(allA){filters.months=[];mBtns.forEach(b=>b.classList.remove('active'))}else{filters.months=[0,1,2,3,4,5,6,7,8,9,10,11];mBtns.forEach(b=>b.classList.add('active'))}render()}
function setAnalyticsView(v){analyticsView=v;document.querySelectorAll('.analytics-toggle-btn').forEach(b=>{b.classList.toggle('active',b.textContent.toLowerCase()===v)});renderAnalytics()}
function renderAnalytics(){const sc=scenarios[currentScenario],scA=activities.filter(a=>sc.activities.includes(a.id)),gests=['FIDELIZACION','RELACIONAMIENTO','COMUNICACIÓN','BRANDING','VARIOS'],gCols={'FIDELIZACION':'#00d4aa','RELACIONAMIENTO':'#6366f1','COMUNICACIÓN':'#f59e0b','BRANDING':'#ec4899','VARIOS':'#8b5cf6'},mData=Array(12).fill(0).map(()=>({}));gests.forEach(g=>{mData.forEach(m=>m[g]=0)});scA.forEach(a=>{const mesesActivos=a.meses.filter(m=>m>0).length||1;const invPorMes=a.inversion/mesesActivos;a.meses.forEach((m,i)=>{if(m>0)mData[i][a.gestion]=(mData[i][a.gestion]||0)+invPorMes})});const baseDsets=gests.map(g=>({label:g,data:mData.map(m=>m[g]||0),backgroundColor:gCols[g],borderRadius:4,borderSkipped:false}));const monthTotals=Array(12).fill(0).map((_,i)=>gests.reduce((s,g)=>s+(mData[i][g]||0),0));const ytdTotals=monthTotals.map((v,i,arr)=>arr.slice(0,i+1).reduce((s,x)=>s+x,0));let finalDsets;if(analyticsView==='acumulado'){finalDsets=gests.map((g,gi)=>({label:g,data:Array(12).fill(0).map((_,i)=>baseDsets[gi].data.slice(0,i+1).reduce((s,x)=>s+x,0)),backgroundColor:gCols[g],borderRadius:4,borderSkipped:false}))}else{finalDsets=baseDsets}const ctx=document.getElementById('monthlyChart');if(monthlyChartInstance)monthlyChartInstance.destroy();monthlyChartInstance=new Chart(ctx,{type:'bar',data:{labels:monthsFull,datasets:finalDsets},options:{responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,beginAtZero:true,ticks:{callback:v=>formatCurrency(v)}}},plugins:{legend:{position:'bottom'},tooltip:{mode:'index',intersect:false,callbacks:{label:c=>`${c.dataset.label}: ${formatCurrency(baseDsets[c.datasetIndex].data[c.dataIndex])}`,afterBody:items=>{const idx=items[0]?.dataIndex??0;return['───────────────────',`Total mes: ${formatCurrency(monthTotals[idx])}`,`YTD acumulado: ${formatCurrency(ytdTotals[idx])}`]}}}}}});const gTots={};gests.forEach(g=>{gTots[g]=scA.filter(a=>a.gestion===g).reduce((s,a)=>s+a.inversion,0)});const tot=Object.values(gTots).reduce((s,v)=>s+v,0);const ctx2=document.getElementById('compositionChart');if(compositionChartInstance)compositionChartInstance.destroy();compositionChartInstance=new Chart(ctx2,{type:'doughnut',data:{labels:gests,datasets:[{data:gests.map(g=>gTots[g]),backgroundColor:gests.map(g=>gCols[g]),borderWidth:2,borderColor:'#12121a'}]},options:{responsive:true,maintainAspectRatio:false,cutout:'60%',plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>{const pct=((c.raw/tot)*100).toFixed(1);return`${c.label}: ${formatCurrency(c.raw)} (${pct}%)`}}}}}});let ldr='',ldrAmt=0,ldrPct=0;gests.forEach(g=>{if(gTots[g]>ldrAmt){ldr=g;ldrAmt=gTots[g];ldrPct=(ldrAmt/tot)*100}});document.getElementById('leader-name').textContent=ldr||'-';document.getElementById('leader-amount').textContent=ldr?`${formatCurrency(ldrAmt)} (${ldrPct.toFixed(1)}%)`:'$0 (0%)'}
window.openMonthDetail=function(mIdx){const flt=filterActivities(),mActs=flt.filter(a=>a.meses[mIdx]>0).map(a=>({nombre:a.actividad,gestion:a.gestion,valor:a.inversion}));if(mActs.length===0)return;const tot=mActs.reduce((s,a)=>s+a.valor,0);document.getElementById('month-modal-title').textContent=`${monthsFull[mIdx]} 2026`;document.getElementById('month-modal-activities').textContent=mActs.length;document.getElementById('month-modal-total').textContent=formatCurrency(tot);const ctx=document.getElementById('monthDetailChart').getContext('2d');if(monthDetailChart)monthDetailChart.destroy();const aCols=mActs.map(a=>{const gC=getGestionClass(a.gestion);return{'fidelizacion':'#00d4aa','relacionamiento':'#6366f1','comunicacion':'#f59e0b','branding':'#ec4899','varios':'#8b5cf6'}[gC]||'#8b5cf6'});monthDetailChart=new Chart(ctx,{type:'doughnut',data:{labels:mActs.map(a=>a.nombre.length>20?a.nombre.substring(0,20)+'...':a.nombre),datasets:[{data:mActs.map(a=>a.valor),backgroundColor:aCols,borderWidth:2,borderColor:'#12121a'}]},options:{responsive:true,maintainAspectRatio:false,cutout:'50%',plugins:{legend:{display:false},tooltip:{backgroundColor:'#1a1a24',borderColor:'#2a2a3a',borderWidth:1,padding:12,callbacks:{label:c=>{const pct=((c.raw/tot)*100).toFixed(1);return`${formatCurrency(c.raw)} (${pct}%)`}}}}}});const lst=document.getElementById('month-modal-list');lst.innerHTML=mActs.map(a=>{const gC=getGestionClass(a.gestion),col={'fidelizacion':'#00d4aa','relacionamiento':'#6366f1','comunicacion':'#f59e0b','branding':'#ec4899','varios':'#8b5cf6'}[gC]||'#8b5cf6',pct=((a.valor/tot)*100).toFixed(1);return`<div class="month-modal-item" onclick="closeMonthModal();openModalByName('${a.nombre.replace(/'/g,"\\'")}')"><div class="month-modal-item-info"><div class="month-modal-item-color" style="background:${col}"></div><span class="month-modal-item-name">${a.nombre}</span><span class="month-modal-item-gestion">${a.gestion}</span></div><span class="month-modal-item-value">${formatCurrency(a.valor)}</span><span class="month-modal-item-percent">${pct}%</span></div>`}).join('');document.getElementById('month-detail-modal').classList.add('open')};
window.closeMonthModal=function(){document.getElementById('month-detail-modal').classList.remove('open')};
window.openModalByName=function(nom){const act=activities.find(a=>a.actividad===nom);if(act)openModal(act.id)};
document.getElementById('month-detail-modal').addEventListener('click',function(e){if(e.target===this)closeMonthModal()});
window.openModal=function(id){const itm=activities.find(a=>a.id===id);if(!itm)return;currentModalId=id;const gC=getGestionClass(itm.gestion),col=getGestionColor(itm.gestion),glw=getGestionGlow(itm.gestion);document.getElementById('modal-title').textContent=itm.actividad;const bdg=document.getElementById('modal-gestion-badge');bdg.textContent=itm.gestion;bdg.style.background=glw;bdg.style.color=col;document.getElementById('modal-tipo').textContent=itm.tipo;document.getElementById('modal-frecuencia').textContent=itm.frecuencia;document.getElementById('modal-unidad').textContent=formatCurrency(itm.unidad);document.getElementById('modal-cantidad').textContent=itm.cantidad;document.getElementById('modal-repeticion').textContent=itm.repeticion||'-';const pct=totalInversion>0?((itm.inversion/totalInversion)*100).toFixed(1):0;document.getElementById('modal-porcentaje').textContent=pct+'%';document.getElementById('modal-inversion').value=itm.inversion;const mdl=document.querySelector('.modal');mdl.style.setProperty('--modal-color',col);mdl.style.setProperty('--modal-color-glow',glw);updateModalCheckbox();const gnt=document.getElementById('modal-gantt');gnt.innerHTML=itm.meses.map((m,i)=>{let cls='modal-gantt-month';if(m===1)cls+=' active';else if(m===2)cls+=' tentative';else if(m===3)cls+=' ondemand';return`<div class="${cls}">${months[i]}</div>`}).join('');document.getElementById('detail-modal').classList.add('open')};
window.closeModal=function(){document.getElementById('detail-modal').classList.remove('open');currentModalId=null};
document.addEventListener('keydown',function(ev){if(ev.key==='Escape'){closeModal();closeMonthModal()}});
document.getElementById('detail-modal').addEventListener('click',function(e){if(e.target===this)closeModal()});
document.getElementById('modal-inversion').addEventListener('change',function(){if(currentModalId!==null){const idx=activities.findIndex(a=>a.id===currentModalId);if(idx!==-1){activities[idx].inversion=parseInt(this.value)||0;render();updateScenarioUI();renderAnalytics()}}});
function openNewActivityModal(){document.getElementById('new-actividad').value='';document.getElementById('new-unidad').value=0;document.getElementById('new-cantidad').value=1;document.getElementById('new-repeticion').value=1;newActivityMonths=[0,0,0,0,0,0,0,0,0,0,0,0];const tps=[...new Set(activities.map(a=>a.tipo))].filter(t=>t),frqs=[...new Set(activities.map(a=>a.frecuencia))].filter(f=>f);document.getElementById('new-tipo').innerHTML=tps.map(t=>`<option value="${t}">${t}</option>`).join('');document.getElementById('new-frecuencia').innerHTML=frqs.map(f=>`<option value="${f}">${f}</option>`).join('');const gnt=document.getElementById('new-activity-gantt');gnt.innerHTML=months.map((m,i)=>`<div class="modal-gantt-month" onclick="toggleNewActivityMonth(${i})">${m}</div>`).join('');document.getElementById('new-activity-modal').classList.add('open')}
function closeNewActivityModal(){document.getElementById('new-activity-modal').classList.remove('open')}
function toggleNewActivityMonth(idx){const vals=[0,1,2,3],cur=newActivityMonths[idx],nxt=vals[(vals.indexOf(cur)+1)%vals.length];newActivityMonths[idx]=nxt;const mDiv=document.getElementById('new-activity-gantt').children[idx];mDiv.className='modal-gantt-month';if(nxt===1)mDiv.classList.add('active');else if(nxt===2)mDiv.classList.add('tentative');else if(nxt===3)mDiv.classList.add('ondemand')}
function saveNewActivity(){const act=document.getElementById('new-actividad').value.trim();if(!act){alert('Por favor ingresá un nombre para la actividad');return}const uni=parseInt(document.getElementById('new-unidad').value)||0,cant=parseInt(document.getElementById('new-cantidad').value)||1,rep=parseInt(document.getElementById('new-repeticion').value)||1,inv=uni*cant*rep,nAct={id:nextActivityId++,gestion:document.getElementById('new-gestion').value,tipo:document.getElementById('new-tipo').value,actividad:act,frecuencia:document.getElementById('new-frecuencia').value,unidad:uni,cantidad:cant,repeticion:rep,inversion:inv,meses:[...newActivityMonths]};activities.push(nAct);if(!scenarios[currentScenario].locked)scenarios[currentScenario].activities.push(nAct.id);closeNewActivityModal();updateScenarioUI();render();renderAnalytics();alert('Actividad creada correctamente')}
function initDynamicFilters(){const tps=[...new Set(activities.map(a=>a.tipo))].filter(t=>t),tCont=document.getElementById('tipo-filters');tps.forEach(t=>{const b=document.createElement('button');b.className='filter-btn';b.dataset.filter='tipo';b.dataset.value=t;b.textContent=t;tCont.appendChild(b)});const frqs=[...new Set(activities.map(a=>a.frecuencia))].filter(f=>f),fCont=document.getElementById('frecuencia-filters');frqs.forEach(f=>{const b=document.createElement('button');b.className='filter-btn';b.dataset.filter='frecuencia';b.dataset.value=f;b.textContent=f.replace(/^\d+- /,'');fCont.appendChild(b)});document.querySelectorAll('[data-filter]').forEach(btn=>{btn.addEventListener('click',function(){const fT=this.dataset.filter,val=this.dataset.value;if(fT==='month'){const mIdx=parseInt(val),idx=filters.months.indexOf(mIdx);if(idx===-1){filters.months.push(mIdx);this.classList.add('active')}else{filters.months.splice(idx,1);this.classList.remove('active')}}else{this.parentElement.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));this.classList.add('active');filters[fT]=val}render()})})}
document.getElementById('btn-export').addEventListener('click',function(){const sc=scenarios[currentScenario],dat=activities.filter(a=>sc.activities.includes(a.id)),wb=XLSX.utils.book_new(),wsD=[],gests=['FIDELIZACION','RELACIONAMIENTO','COMUNICACIÓN','BRANDING','VARIOS'],tot=dat.reduce((s,a)=>s+a.inversion,0);wsD.push(['Gestión','Tipo','Actividad','Frecuencia','ENE','FEB','MAR','ABR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DIC','Unidad','Cantidad','Repetición','Inversión','%']);gests.forEach(g=>{const itms=dat.filter(a=>a.gestion===g);if(itms.length===0)return;itms.forEach(a=>{const pct=((a.inversion/tot)*100).toFixed(1)+'%',mSym=a.meses.map(m=>{if(m===1)return'●';if(m===2)return'?';if(m===3)return'x';return''});wsD.push([a.gestion,a.tipo,a.actividad,a.frecuencia,...mSym,a.unidad,a.cantidad,a.repeticion,a.inversion,pct])});const sub=itms.reduce((s,a)=>s+a.inversion,0),subP=((sub/tot)*100).toFixed(1)+'%';wsD.push([`SUBTOTAL ${g}`,'','','','','','','','','','','','','','','','','','',sub,subP]);wsD.push([])});wsD.push(['TOTAL GENERAL','','','','','','','','','','','','','','','','','','',tot,'100%']);const ws=XLSX.utils.aoa_to_sheet(wsD);ws['!cols']=[{wch:18},{wch:20},{wch:45},{wch:20},...Array(12).fill({wch:4}),{wch:12},{wch:10},{wch:10},{wch:15},{wch:8}];XLSX.utils.book_append_sheet(wb,ws,'Datos');const wsR=[],gTot={};wsR.push([sc.name]);wsR.push([]);wsR.push(['Total Actividades',dat.length]);wsR.push(['Inversión Total',tot]);wsR.push([]);wsR.push(['Resumen por Gestión']);wsR.push(['Gestión','Actividades','Inversión','%']);gests.forEach(g=>{const itms=dat.filter(a=>a.gestion===g);if(itms.length>0){const sub=itms.reduce((s,a)=>s+a.inversion,0),pct=((sub/tot)*100).toFixed(1)+'%';wsR.push([g,itms.length,sub,pct])}});const wsRS=XLSX.utils.aoa_to_sheet(wsR);wsRS['!cols']=[{wch:20},{wch:15},{wch:15},{wch:10}];XLSX.utils.book_append_sheet(wb,wsRS,'Resumen');const fn=`${sc.name.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.xlsx`;XLSX.writeFile(wb,fn)});
document.addEventListener('DOMContentLoaded',function(){initDynamicFilters();initScenarios();render();renderAnalytics()});
</script>
<script>
const CLAVE='F2026';
function checkPassword(){const inp=document.getElementById('password-input').value;if(inp===CLAVE){document.getElementById('login-screen').classList.add('hidden');document.getElementById('main-content').classList.add('visible');sessionStorage.setItem('authenticated','true')}else{document.getElementById('login-error').style.display='block';document.getElementById('password-input').value=''}}
if(sessionStorage.getItem('authenticated')==='true'){document.getElementById('login-screen').classList.add('hidden');document.getElementById('main-content').classList.add('visible')}
</script>
</body>
</html>
